<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom" xmlns:planet="http://planet.intertwingly.net/" xmlns:indexing="urn:atom-extension:indexing" indexing:index="no"><access:restriction xmlns:access="http://www.bloglines.com/about/specs/fac-1.0" relationship="deny"/>
  <title>Planet Neuroscience</title>
  <updated>2016-11-24T22:27:51Z</updated>
  <generator uri="http://intertwingly.net/code/venus/">Venus</generator>
  <author>
    <name>Ankur Sinha</name>
    <email>ankursinha AT fedoraproject DOT org</email>
  </author>
  <id>http://sanjayankur31.github.io/atom.xml</id>
  <link href="http://sanjayankur31.github.io/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="http://sanjayankur31.github.io/planet-neuroscience" rel="alternate"/>

  <entry>
    <id>tag:ankursinha.in,2016-10-17:blog/2016/10/17/on-jargon.html</id>
    <link href="http://ankursinha.in/blog/2016/10/17/on-jargon.html" rel="alternate" type="text/html"/>
    <title>On jargon</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p>Jargon is more often than not looked at unfavourably. Jargon is just the "language of a trade" and so, by itself, I don't see why I should denounce it. Rather, to me, it is the usage of jargon that is the issue. If you think of a workplace where people are aware of the context and meaning of certain jargon, I see no reason why it isn't appropriate usage. In fact, in such scenarios, jargon makes conversation efficient since the parties must not needlessly simplify their communications. So, when I go over to my lab mate's desk and say "<em>well, the STDP rule doesn't seem to result in an AI state</em>", he knows exactly what I mean. I'd find it quite difficult to rephrase that sentence to make it any simpler. The same applies for most professions if not all of them. Whether it's farming or mechanics; IT or medicine; cooking or sewing; designing or the media; they will all have some specialised terminology. It is just normal evolution of language in the same way that "selfie" is now a word. Jargon is simply a set of words that encapsulate concepts that are frequently used in a context.</p>
<p>So why are we up in arms about jargon, then? Why is everyone continuously talking about how we need to cut it out? Quite simply, because when jargon is used in the wrong scenario, it hampers transfer of information. If work related terminology is used in a social setting where other listeners are not privy to it, for example, the conversation does not serve to pass on any material. Furthermore, it usually has the effect of making the audience feel out of place. It is quite similar to speaking to a single member of a group in a language that the others do not comprehend. It is considered impolite.</p>
<p>To take it a step further, jargon seems to be used frequently with the malintent to obfuscate - especially in sales and marketing. The idea seems to be to coin and use fancy wording to trick consumers into buying products. The billboards and slogans that we see on a daily basis while not untrue, are not always created with aim to elucidate facts.</p>
<p>Another use of jargon is straightforward snobbery. It makes the snob feel like part of an exclusive club. There isn't much to say about this other than that one should simply not engage with such individuals.</p>
<p>Scenarios where the use of jargon is unintentional are more complex to deal with. Most research falls in this category. Consider people like me who spend a majority of their time in an environment that requires the use of an uncommon vocabulary. So, I read research papers that contain specific words, I write papers using these same words, the discussions I partake in utilise these too - this jargon is quite unavoidable to a large extent in work life. I'm only 2 years into my Ph.D. and I find it hard to speak about the same subject matter without employing the same dialect already. While this does not affect my daily activities as they are limited to colleagues who are well versed in our diction, it greatly limits my ability to spread the science I work in to a wider audience. This, in contrast, does effect me, and you too. If we're not working similar areas, we have very little understanding of each other's work.</p>
<p>While I can't speak for types of work, this, in general, is an issue in research and academia - the lack of ability in us researchers to disseminate our work to people in other streams, especially non research careers, is an accepted weakness.</p>
<p>Computational neuroscience, for example, is extremely multidisciplinary. At my lab alone, we have biologists, physicist, mathematicians, and us computer scientists, all working under the same roof on similar research questions. The dialect each of us speak is different. Yet, we read and publish in the same channels. When I read a paper that is heavy on biological detail, I find it much harder because the text utilises biological terminology that I'm not well aware of. In our case, though, there's only the one solution of learning what we need to know. It is how we manage to collaborate across disciplines, and it takes work - the difference in jargon ever so slightly increasing the required exertions.</p>
<p>Extend this scenario to someone who isn't working in computational neuroscience at all. Of course, it'll be even harder for them to understand the same text. Given how important research is for all life in general, it is imperative that people who do not conduct research be made aware of progress that is continuously made. If you don't understand why research is important, let me point out to you that <em>every</em> manufactured product you use in your home is the end result of some research somewhere. Take a moment to wonder how it all came about - it isn't magic; it is years of hard work and failure.</p>
<p>To insure the future of research, it is important that young students are exposed to it at an early age. It is the simplest way of arousing enough interest in them to guarantee that research receives a constant stream of capable bearers to build on past innovations. It really doesn't matter what they take up - contributions to each field count.</p>
<p>It is also helpful for consumers to have some idea of how things are manufactured and the amount of work that goes into it. It helps them pick between brands and decide what price they should pay for a product. A general awareness helps build immunity to the different tricks in use today that gently nudge consumers into buying products - creating demand for a product that wasn't required some time before.</p>
<p>A last but important note is that most research makes use of public funds that are obtained via government grants. If the tax payer is funding some research, the tax payer should know how the money is being utilised.</p>
<p>So, yes, making research information easily accessible to everyone is of great value. This is where jargon stands out as quite a bottle neck. Individuals that are not aware of the context, or those that do not have the required background knowledge cannot be expected to read research papers to understand the state of knowledge. Rather, academics have to work towards simplifying the data to an extent that it can be consumed by individuals from all walks of life. This isn't easy, and simplification usually goes hand in hand with omission of lesser important details but it is certainly possible to synthesise an overall picture of a concept.</p>
<p>What I've written isn't new by any standards. The problem is well known, and communities are working towards making knowledge more understandable. If you watch the stuff the BBC puts up, for example, you'll see a lot of work by individuals like <a class="reference external" href="https://en.wikipedia.org/wiki/Brian_Cox_(physicist)">Professor Brian Cox</a> that is aimed at explaining complex physical phenomena in simpler terms. A start has certainly been made.</p>
<p>The point of this post was to give myself some time to think about the issue. After writing about a thousand words on the subject, I have a better understanding of it myself. I also have a better handle on what I should do to do my bit. It simply takes practice and some feedback. That's all it is. So, as I blog frequently about my Fedora related activities, I am going to make more of an attempt to write about my research too. A target is always helpful. Since it takes some effort at the moment, I'm going to set myself a target of one research related post every two to three weeks to begin with. Today being the 16th of October, I'll publish the first one before the 7th of November. Let's see how that goes.</p></div>
    </summary>
    <updated>2016-10-17T07:26:30Z</updated>
    <published>2016-10-17T07:26:30Z</published>
    <category term="Computational neuroscience"/>
    <category term="Fedora"/>
    <category term="Social"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-09-02:blog/2016/09/02/using-neuron-part-ii.html</id>
    <link href="http://ankursinha.in/blog/2016/09/02/using-neuron-part-ii.html" rel="alternate" type="text/html"/>
    <title>Using NEURON - Part II</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p><a class="reference external" href="https://senselab.med.yale.edu/ModelDB/ModelList.cshtml?id=1882">ModelDB</a> is a popular resource where the computational neuroscience community puts up models that were used in various publications. Since I'm quite new to <a class="reference external" href="http://www.neuron.yale.edu/neuron/">NEURON</a>, I thought I'd play with some existing models to get a hang of things. Here I document how to run an existing model.</p>
<p><a class="reference external" href="https://senselab.med.yale.edu/ModelDB/ModelList.cshtml?id=1882">ModelDB</a> has quite a few models that use <a class="reference external" href="http://www.neuron.yale.edu/neuron/">NEURON</a>. Find one that suits you. I'll pick <a class="reference external" href="https://senselab.med.yale.edu/ModelDB/ShowModel.cshtml?model=139653">L5b PC model constrained for BAC firing and perisomatic current step firing (Hay et al., 2011)</a> for now.</p>
<div class="section" id="download-the-model">
<h2>Download the model</h2>
<p><a class="reference external" href="https://senselab.med.yale.edu/modeldb/eavBinDown.cshtml?o=139653&amp;a=23&amp;mime=application/zip">Download the zip</a> file from the model page to a convenient location. There's a link right on the top of the page. Extract it.</p>
<pre class="code bash literal-block">$ unzip L5bPCmodelsEH.zip
$ lash
total 668K
4.0K drwxr-xr-x. <span class="m">7</span> asinha asinha 4.0K Mar <span class="m">30</span>  <span class="m">2013</span> L5bPCmodelsEH
664K -rw-r-----. <span class="m">1</span> asinha asinha 662K Sep  <span class="m">2</span> 13:55 L5bPCmodelsEH.zip
</pre>
</div>
<div class="section" id="building-and-running-the-model">
<h2>Building and running the model</h2>
<p>Enter the directory:</p>
<pre class="code bash literal-block"><span class="nb">cd</span> L5bPCmodelsEH/
</pre>
<p><a class="reference external" href="http://www.neuron.yale.edu/neuron/">NEURON</a> code comprises of two sets of code files. You have the HOC files, and the NMODL files. NMODL files need to be compiled before the model can be run.</p>
<pre class="code bash literal-block">$ ~/dump/neuron-installation/x86_64/bin/nrnivmodl mod
Creating x86_64 directory <span class="k">for</span> .o files.

/home/asinha/dump/neuron-blog/L5bPCmodelsEH
mod/CaDynamics_E2.mod mod/Ca_HVA.mod mod/Ca_LVAst.mod mod/epsp.mod mod/Ih.mod mod/Im.mod mod/K_Pst.mod mod/K_Tst.mod mod/Nap_Et2.mod mod/NaTa_t.mod mod/NaTs2_t.mod mod/SK_E2.mod mod/SKv3_1.mod
CaDynamics_E2.mod Ca_HVA.mod Ca_LVAst.mod epsp.mod Ih.mod Im.mod K_Pst.mod K_Tst.mod Nap_Et2.mod NaTa_t.mod NaTs2_t.mod SK_E2.mod SKv3_1.mod
<span class="s2">"/home/asinha/dump/neuron-installation/x86_64/bin/nocmodl"</span> CaDynamics_E2
Translating CaDynamics_E2.mod into CaDynamics_E2.c
Thread Safe
<span class="s2">"/home/asinha/dump/neuron-installation/share/nrn/libtool"</span> --tag<span class="o">=</span>CC --mode<span class="o">=</span>compile mpicc -DHAVE_CONFIG_H  -I. -I.. -I<span class="s2">"/home/asinha/dump/neuron-installation/include/nrn"</span> -I<span class="s2">"/home/asinha/dump/neuron-installation/x86_64/lib"</span>      -O2 -g -pipe -Wall -Werror<span class="o">=</span>format-security -Wp,-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span> -fexceptions -fstack-protector-strong --param<span class="o">=</span>ssp-buffer-size<span class="o">=</span><span class="m">4</span> -grecord-gcc-switches -specs<span class="o">=</span>/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune<span class="o">=</span>generic -c -o CaDynamics_E2.lo CaDynamics_E2.c
libtool: compile:  mpicc -DHAVE_CONFIG_H -I. -I.. -I/home/asinha/dump/neuron-installation/include/nrn -I/home/asinha/dump/neuron-installation/x86_64/lib -O2 -g -pipe -Wall -Werror<span class="o">=</span>format-security -Wp,-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span> -fexceptions -fstack-protector-strong --param<span class="o">=</span>ssp-buffer-size<span class="o">=</span><span class="m">4</span> -grecord-gcc-switches -specs<span class="o">=</span>/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune<span class="o">=</span>generic -c CaDynamics_E2.c  -fPIC -DPIC -o .libs/CaDynamics_E2.o
CaDynamics_E2.c:94:34: warning: missing braces around initializer <span class="o">[</span>-Wmissing-braces<span class="o">]</span>
  static VoidFunc hoc_intfunc<span class="o">[]</span> <span class="o">=</span> <span class="o">{</span>
  ...
  ....
  ...
  ...
</pre>
<p>You'll see a new <code>x86_64</code> directory which contains the compiled code. Now, simply run <a class="reference external" href="http://www.neuron.yale.edu/neuron/">NEURON</a> as usual. If everything went well, the simulation will run:</p>
<pre class="code bash literal-block">$ ~/dump/neuron-installation/x86_64/bin/nrngui mosinit.hoc
</pre>
<p>Remember that you must run <code>nrngui</code> in the directory where the <code>x86_64</code> directory resides for <a class="reference external" href="http://www.neuron.yale.edu/neuron/">NEURON</a> to find it.</p>
<p>That's it!</p>
</div></div>
    </summary>
    <updated>2016-09-02T12:39:16Z</updated>
    <published>2016-09-02T12:39:16Z</published>
    <category term="Fedora"/>
    <category term="Neuron"/>
    <category term="Computational neuroscience"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-08-27:blog/2016/08/27/quickly-scripting-a-grid-search-for-parameter-tuning.html</id>
    <link href="http://ankursinha.in/blog/2016/08/27/quickly-scripting-a-grid-search-for-parameter-tuning.html" rel="alternate" type="text/html"/>
    <title>Quickly scripting a grid-search for parameter tuning</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p>A lot of models rely on different parameters. In my cortical models, these are usually variables like conductances of different sets of synapses, the sparsity of different synapse sets, learning rates of spike time dependent plasticity learning rules and so on. Given how finely tuned neuronal networks sometimes are, models don't depict the expected behaviours for the entire domain of parameter values. Instead, we often must find the right ranges of these parameters.</p>
<p>In my simulations, I have some sets of synapses, and in my recent investigations, I needed to find the right "balance" between them. The standard way of going about this is to carry out an organised parameter search, what I think is referred to as a "grid search". In a grid search, each point in the parameter space is tested to find the ranges where the required behaviour is simulated - really just simple brute force at play here. Now, since I have three parameters to test, my parameter space would be a three dimensional grid - the Cartesian product of the domains of the three parameters - <code>p1 x p2 x p3</code>. For all possible ordered sets of p1, p2, and p3, I need to run my simulation - the number of possible combinations being <code>n(p1) x n(p2) x n(p3)</code>, where <code>n</code> is the cardinality of each set.</p>
<p>Of course, I wrote myself a script. Modifying the parameters by hand and then queuing up all these simulations manually on the cluster would just take too much time.</p>
<div class="section" id="the-idea">
<h2>The idea</h2>
<p>It's a simple Python script, and this fits well with my <a class="reference external" href="http://ankursinha.in/blog/feeds/categories/20160531-some-tips-and-tricks-for-running-simulations-on-a-cluster.rst">workflow</a> (which intensively uses Git and scripts to queue jobs on the cluster). The idea is:</p>
<ul class="simple">
<li>create a new Git branch for the grid search (so we keep things organised!)</li>
<li>use a simple scripting language to iterate over the parameter space</li>
<li>modify the parameters in the simulation source code</li>
<li>create a new commit for each point in the parameter space</li>
<li>queue up all these commits on the cluster</li>
</ul>
</div>
<div class="section" id="the-script">
<h2>The script</h2>
<p>I've used Python - you can use another scripting language that you prefer. I wouldn't recommend a shell script - even though it's powerful, handling arrays and floats and the sort is quite tedious in bash.</p>
<pre class="code Python literal-block"><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">"""
Copyright 2016 Ankur Sinha
Author: Ankur Sinha &lt;sanjay DOT ankur AT gmail DOT com&gt;

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
"""</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">datetime</span>


<span class="k">class</span> <span class="nc">GridSearch</span><span class="p">:</span>

    <span class="sd">"""Set up your simulations for a grid search.


    This will modify the source in a branch, make changes, commit
    and then you can set these commits up on the cluster.
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Initialise."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s2">"/path/to/source/file/"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">branch</span> <span class="o">=</span> <span class="s2">"master"</span>

    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Print usage."""</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Usage:"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"python3 grid_search.py &lt;branch&gt;"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Branch MUST be specified."</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">range_dict</span><span class="p">):</span>
        <span class="sd">"""Set it up."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">branch</span> <span class="o">=</span> <span class="n">branch</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_dict</span><span class="p">[</span><span class="s1">'param1'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param1_increment</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param1_min</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param1'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param1_max</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param1'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">param1_increment</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_dict</span><span class="p">[</span><span class="s1">'param1'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param1_increment</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param1'</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param1_min</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param1'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param1_max</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param1'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">param1_increment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"param1 not found in dict. Exiting."</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_dict</span><span class="p">[</span><span class="s1">'param2'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param2_increment</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param2_min</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param2'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param2_max</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param2'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">param2_increment</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_dict</span><span class="p">[</span><span class="s1">'param2'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param2_increment</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param2'</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param2_min</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param2'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param2_max</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param2'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">param2_increment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"param2 not found in dict. Exiting."</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_dict</span><span class="p">[</span><span class="s1">'param3'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param3_increment</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param3_min</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param3'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param3_max</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param3'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">param3_increment</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_dict</span><span class="p">[</span><span class="s1">'param3'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param3_increment</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param3'</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param3_min</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param3'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param3_max</span> <span class="o">=</span> <span class="n">range_dict</span><span class="p">[</span><span class="s1">'param3'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">param3_increment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"param3 not found in dict. Exiting."</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Run."""</span>
        <span class="c1"># checkout the branch</span>
        <span class="n">git_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"checkout"</span><span class="p">,</span> <span class="s2">"-b"</span><span class="p">,</span> <span class="s2">"grid_search-{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())),</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch</span><span class="p">]</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s1">'git'</span><span class="p">]</span> <span class="o">+</span> <span class="n">git_args</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">param1</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param1_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param1_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param1_increment</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">param2</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param2_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param2_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param2_increment</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">param3</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param3_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param3_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param3_increment</span><span class="p">):</span>

                    <span class="n">sed_args_param1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sed'</span><span class="p">,</span> <span class="s1">'-i'</span><span class="p">,</span>
                                <span class="s2">"s/param1 = .*$/param1 = {}/"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param1</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sed_args_param1</span><span class="p">)</span>

                    <span class="n">sed_args_param2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sed'</span><span class="p">,</span> <span class="s1">'-i'</span><span class="p">,</span>
                                <span class="s2">"s/param2 = .*$/param2 = {}/"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param2</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sed_args_param2</span><span class="p">)</span>

                    <span class="n">sed_args_param3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sed'</span><span class="p">,</span> <span class="s1">'-i'</span><span class="p">,</span>
                                <span class="s2">"s/param3 = .*$/param3 = {}/"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param3</span><span class="p">),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">sed_args_param3</span><span class="p">)</span>

                    <span class="n">git_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"add"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">]</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s1">'git'</span><span class="p">]</span> <span class="o">+</span> <span class="n">git_args</span><span class="p">)</span>

                    <span class="n">commit_msg</span> <span class="o">=</span> <span class="s2">"""{} {} {} {}"""</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()),</span> <span class="n">param1</span><span class="p">,</span>
                        <span class="n">param2</span><span class="p">,</span> <span class="n">param3</span><span class="p">)</span>

                    <span class="n">git_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"commit"</span><span class="p">,</span> <span class="s2">"-m"</span><span class="p">,</span> <span class="n">commit_msg</span><span class="p">]</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s1">'git'</span><span class="p">]</span> <span class="o">+</span> <span class="n">git_args</span><span class="p">)</span>

        <span class="n">git_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"checkout"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch</span><span class="p">]</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s1">'git'</span><span class="p">]</span> <span class="o">+</span> <span class="n">git_args</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">GridSearch</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">search</span><span class="o">.</span><span class="n">usage</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># dictionary that holds the required grid ranges</span>
        <span class="c1"># specify min, max if want a grid search, else specify only one value</span>
        <span class="c1"># if you specify max, min, you must specify increment</span>
        <span class="n">setup_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'param1'</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.</span><span class="p">],</span>
            <span class="s1">'param2'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
            <span class="s1">'param3'</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">search</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">branch</span><span class="p">,</span> <span class="n">setup_dict</span><span class="p">):</span>
            <span class="n">search</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre>
<p>Since I'm calling <code>sed</code> to modify my source and replace the parameter values, the only requirement here is that my source code needs to have the three lines (look at the regular expressions):</p>
<pre class="code Python literal-block"><span class="n">param1</span> <span class="o">=</span> <span class="o">..</span>
<span class="n">param2</span> <span class="o">=</span> <span class="o">..</span>
<span class="n">param3</span> <span class="o">=</span> <span class="o">..</span>
</pre>
<p>If all goes well, you should have a new branch:</p>
<pre class="code console literal-block"><span class="go">* 74866b6 - (3 months ago) Bugfix - neurons first, synapses later — Ankur Sinha (Ankur Sinha Gmail)
| * fd6a7fa - (5 days ago) 2016-08-22 3.0 3.0 -30.0 — Ankur Sinha (Ankur Sinha Gmail) (origin/grid_search-2016-08-22, grid_search-2016-08-22)
| * 33c95be - (5 days ago) 2016-08-22 3.0 3.0 -25.0 — Ankur Sinha (Ankur Sinha Gmail)
| * 51f96c1 - (5 days ago) 2016-08-22 3.0 3.0 -20.0 — Ankur Sinha (Ankur Sinha Gmail)
| * e8c106e - (5 days ago) 2016-08-22 3.0 3.0 -15.0 — Ankur Sinha (Ankur Sinha Gmail)
| * eaa7341 - (5 days ago) 2016-08-22 3.0 3.0 -10.0 — Ankur Sinha (Ankur Sinha Gmail)
| * 4597114 - (5 days ago) 2016-08-22 3.0 3.0 -5.0 — Ankur Sinha (Ankur Sinha Gmail)
| * a111e00 - (5 days ago) 2016-08-22 3.0 2.5 -30.0 — Ankur Sinha (Ankur Sinha Gmail)
| * 5261f4b - (5 days ago) 2016-08-22 3.0 2.5 -25.0 — Ankur Sinha (Ankur Sinha Gmail)
| * d10a686 - (5 days ago) 2016-08-22 3.0 2.5 -20.0 — Ankur Sinha (Ankur Sinha Gmail)
| * 91bc10e - (5 days ago) 2016-08-22 3.0 2.5 -15.0 — Ankur Sinha (Ankur Sinha Gmail)
| * add5188 - (5 days ago) 2016-08-22 3.0 2.5 -10.0 — Ankur Sinha (Ankur Sinha Gmail)
| * c93c817 - (5 days ago) 2016-08-22 3.0 2.5 -5.0 — Ankur Sinha (Ankur Sinha Gmail)
| * 8e779b9 - (5 days ago) 2016-08-22 3.0 2.0 -30.0 — Ankur Sinha (Ankur Sinha Gmail)
| * 9f67e1c - (5 days ago) 2016-08-22 3.0 2.0 -25.0 — Ankur Sinha (Ankur Sinha Gmail)
.....</span>
</pre>
<p>Now, with the help of some bash hacking I get a list of all the commits I need to queue up in a single line:</p>
<pre class="code bash literal-block"><span class="c1"># list all commits reachable from grid_search.. branch but not from the base_branch
</span>$ git log base_branch..grid_search-2016-08-22  --oneline <span class="p">|</span> cut -f1 -d<span class="s2">" "</span> <span class="p">|</span> tr <span class="s2">"\n"</span> <span class="s2">" "</span>
fd6a7fa 33c95be 51f96c1 .. e8c106e eaa7341
</pre>
<p>Then, I use the bash <code>for</code> construct to queue them all up as before:</p>
<pre class="code bash literal-block">$ <span class="k">for</span> commit in fd6a7fa 33c95be 51f96c1 .. e8c106e eaa7341<span class="p">;</span> <span class="k">do</span> ./start-job.sh <span class="s2">"</span><span class="nv">$commit</span><span class="s2">"</span> 32<span class="p">;</span> sleep 1m<span class="p">;</span> <span class="k">done</span>
</pre>
<p>Note - I used the <code>sleep</code> command to space out each job by a minute. This is because my workflow uses folder names which are timestamps of when the job was queued up, like this: <code>201608121234</code> (YYYYMMDDHHMM). So, I can't have two commits starting at the same minute.</p>
<p>There are many ways of carrying out the same method. This is what I quickly came up with. <a class="reference external" href="http://scikit-learn.org">Scikit</a>, for example has <a class="reference external" href="http://scikit-learn.org/stable/modules/grid_search.html">methods for grid search</a>, but they don't gel well with my simulations.</p>
</div>
<div class="section" id="postprocessing-all-this-data">
<h2>Postprocessing all this data</h2>
<p>I have a bunch of scripts for post processing too - this grid search had 36 simulations, the postprocessing is still trudging along. The bigger question is: is there a good way of visualising all these results? I've had to resort to a spreadsheet - but if you have any suggestions, please do let me know. I really haven't found a nice front-end that would let me log results to a database and visualise them - over time, over parameters and so on - does anyone know one? What do people use to keep track of all their data?</p>
<p>Anyway, it's a long weekend here with Monday being a bank holiday. Enjoy the weekend, everyone!</p>
</div></div>
    </summary>
    <updated>2016-08-27T09:10:04Z</updated>
    <published>2016-08-27T09:10:04Z</published>
    <category term="Computational neuroscience"/>
    <category term="Fedora"/>
    <category term="Git"/>
    <category term="Programming"/>
    <category term="Python"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-08-05:blog/2016/08/05/using-neuron-part-i.html</id>
    <link href="http://ankursinha.in/blog/2016/08/05/using-neuron-part-i.html" rel="alternate" type="text/html"/>
    <title>Using NEURON - Part I</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><div class="section" id="what-is-neuron">
<h2>What is NEURON</h2>
<p>From the <a class="reference external" href="http://www.neuron.yale.edu/neuron/what_is_neuron">website</a>:</p>
<p><em>NEURON is a simulation environment for modeling individual neurons and networks of neurons. It provides tools for conveniently building, managing, and using models in a way that is numerically sound and computationally efficient. It is particularly well-suited to problems that are closely linked to experimental data, especially those that involve cells with complex anatomical and biophysical properties.</em></p>
</div>
<div class="section" id="installing-neuron-on-fedora-24">
<h2>Installing NEURON on Fedora 24</h2>
<p>The first thing you do is install the simulator. I've been trying to build <a class="reference external" href="https://copr.fedorainfracloud.org/coprs/ankursinha/neuroscience-research/">copr</a> packages but they're not as simple as I'd have liked - the configurations that upstream uses for iv and neuron are outdated and require quite a bit of patching.</p>
<div class="section" id="download-the-sources">
<h3>Download the sources</h3>
<p>First, download the source files:</p>
<pre class="code bash literal-block"><span class="c1"># Make sure we're in the /home/&lt;user&gt; directory
</span><span class="nb">cd</span>
<span class="c1"># Make a new directory - use what you want but be consistent
</span>mkdir -p dump/neuron

<span class="c1"># Another one for the installed files
# You can use /opt or /usr/local or any other directory
# Using a directory in your home folder doesn't require root access
</span>mkdir -p dump/neuron-installation

<span class="c1"># Keep the sources here
</span><span class="nb">cd</span> ~/dump/neuron

<span class="c1"># Install mercurial to checkout the neuron source code
</span>sudo dnf install hg
<span class="c1"># Download the source code
# Can't build from the latest tar somehow.
# http://www.neuron.yale.edu/neuron/download/getdevel
</span>hg clone http://www.neuron.yale.edu/hg/neuron/nrn

<span class="c1"># Check http://www.neuron.yale.edu/neuron/download/getstd for correct links
</span>wget http://www.neuron.yale.edu/ftp/neuron/versions/v7.4/iv-19.tar.gz

<span class="c1"># Untar the source for iv - this seems to work
</span>tar -xvf iv-19.tar.gz
</pre>
</div>
<div class="section" id="prep">
<h3>Prep</h3>
<p>We need to build iv first. On Fedora 24, the default gcc flags include <code>-Wformat-security</code> so a quick patch needs to be applied to iv to get it to build. The patch <a class="reference external" href="https://www.neuron.yale.edu/phpBB/viewtopic.php?f=20&amp;t=3536">has been reported here</a>:</p>
<pre class="code diff literal-block"><span class="gh">diff -ur ../iv-18.orig/src/lib/IV-2_6/matcheditor.cpp ./src/lib/IV-2_6/matcheditor.cpp
</span><span class="gd">--- ../iv-18.orig/src/lib/IV-2_6/matcheditor.cpp   2014-01-08 19:10:44.895487120 +1100
</span><span class="gi">+++ ./src/lib/IV-2_6/matcheditor.cpp   2014-01-08 19:11:05.949315579 +1100
</span><span class="gu">@@ -82,7 +82,7 @@
</span>         strncpy(buf, text-&gt;Text(), length);
         while (length &gt; 0) {
             buf[length] = '\0';
<span class="gd">-            if (sscanf(buf, pattern) == EOF) {
</span><span class="gi">+            if (sscanf(buf, "%s", pattern) == EOF) {
</span>                 break;
             }
             --length;
</pre>
<p>Copy the diff into a file and call it <code>iv-format-security.patch</code>. Place this in the directory where you have the neuron sources (<code>~/dump/neuron</code>).
To apply the patch, enter the uncompressed iv directory:</p>
<pre class="code bash literal-block"><span class="nb">cd</span> iv
patch -p1 &lt; ../iv-format-security.patch
<span class="c1"># On success, it'll say:
# patching file src/lib/IV-2_6/matcheditor.cpp</span>
</pre>
<p>Before we build either iv or neuron, we need to install the build dependencies:</p>
<pre class="code bash literal-block"><span class="c1"># Install dependencies from the standard repositories
</span>sudo dnf install xorg-x11-server-devel chrpath libtiff-devel imake libX11-devel automake autoconf libtool libXext-devel ncurses-devel readline-devel Random123-devel Cython openmpi-devel
</pre>
<p>I've left out Java - I have no intention of using the Java support. Instead of openmpi, you can also use mpich - that's up to you - replace <code>openmpi-devel</code> with <code>mpich-devel</code>.</p>
</div>
<div class="section" id="build">
<h3>Build</h3>
<p>Follow the instructions <a class="reference external" href="http://www.neuron.yale.edu/neuron/download/compile_linux">here</a>.
First we build iv:</p>
<pre class="code bash literal-block"><span class="c1"># we're already in the iv source directory
# ./configure --help for all available options
# I use the default Fedora CFLAGS and CXXFLAGS
# You needn't use these
# rpm -E %optflags will tell you what the default ones on your system are
# echo $CFLAGS
# -O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic
# echo $CXXFLAGS
# -O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic
</span>
<span class="c1"># iv doesn't build with -Wnarrowing which is also default, so we disable it
</span><span class="nb">export</span> <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CFLAGS</span><span class="s2"> -Wno-narrowing"</span>
<span class="nb">export</span> <span class="nv">CXXFLAGS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CXXFLAGS</span><span class="s2"> -Wno-narrowing"</span>

<span class="c1"># configure, make, make install
</span>./configure --prefix<span class="o">=</span>/home/asinha/dump/neuron-installation/ --with-x
<span class="c1"># I have 24 processors, check to see how many you do
</span>make -j24
make install
</pre>
<p>Then, we build neuron</p>
<pre class="code bash literal-block"><span class="nb">cd</span> ../nrn
<span class="c1"># configure --help to see all options
# Enable MPI
</span>module load mpi/openmpi-x86_64
<span class="c1"># More change to flags to get the thing to build
</span><span class="nb">export</span> <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CFLAGS</span><span class="s2"> -Wno-narrowing -std=c99 -D_POSIX_C_SOURCE=200809L"</span>
<span class="nb">export</span> <span class="nv">CXXFLAGS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CXXFLAGS</span><span class="s2"> -Wno-narrowing -D_POSIX_C_SOURCE=200809L"</span>
./build.sh
./configure --prefix<span class="o">=</span>/home/asinha/dump/neuron-installation/ --with-x --with-paranrn --with-mpi --with-multisend --with-nrniv --with-iv<span class="o">=</span>/home/asinha/dump/neuron-installation
<span class="c1"># I have 24 processors, check to see how many you do
</span>make -j24
make install
</pre>
</div>
<div class="section" id="check">
<h3>Check</h3>
<p>Follow the instructions <a class="reference external" href="http://www.neuron.yale.edu/neuron/download/compile_linux">here</a>.</p>
<pre class="code bash literal-block"><span class="nb">cd</span>
<span class="nb">cd</span> dump/neuron-installation/
find . -name <span class="s2">"neurondemo"</span>
<span class="c1"># You'll get something like: ./x86_64/bin/neurondemo
</span>./86_64/bin/neurondemo
<span class="c1"># Will give out something like:
# NEURON -- VERSION 7.5 (1454:2350fc838a79) 2016-08-01
# Duke, Yale, and the BlueBrain Project -- Copyright 1984-2016
# See http://neuron.yale.edu/neuron/credits
#
# loading membrane mechanisms from /home/asinha/dump/neuron-installation/share/nrn/demo/release/x86_64/.libs/libnrnmech.so
# Additional mechanisms from files
#  cabpump.mod cachan1.mod camchan.mod capump.mod invlfire.mod khhchan.mod mcna.mod nacaex.mod nachan.mod release.mod
# first instance of j
# first instance of itmp
# first instance of using_cvode_
# first instance of movie_frame_dur_
# first instance of realtime
# first instance of running_
# first instance of rtstart
# first instance of stdrun_quiet
# first instance of screen_update_invl
# first instance of tstop
# first instance of steps_per_ms
# first instance of nstep_steprun
# first instance of runStopAt
# first instance of runStopIn
# first instance of global_ra
# first instance of mapped_nrnmainmenu_
# first instance of v_init
# first instance of n_graph_lists
# first instance of i
# first instance of eventslow
# first instance of eventcount
# first instance of cnt
# oc&gt;
#</span>
</pre>
</div>
<div class="section" id="post">
<h3>Post</h3>
<p>Last, we update the PATH and things so that everything works smoothly in the future. The docs suggest an <code>nrnenv</code> file that can be sourced in the <code>.bashrc</code> file. We'll just follow the suggested method.</p>
<pre class="code bash literal-block">cat &gt;&gt; ~/dump/neuron-installation/x86_64/bin/nrnenv <span class="s">&lt;&lt; EOF
export NRNINSTALLATION="\$HOME/dump/neuron-installation"
export NRNCPU="x86_64"
export PATH="\$PATH:\$NRNINSTALLATION/\$NRNCPU/bin"

EOF</span>
</pre>
<p>and modify <code>.bashrc</code> to source it:</p>
<pre class="code bash literal-block"><span class="nb">echo</span> <span class="s2">"source /home/asinha/dump/neuron-installation/x86_64/bin/nrnenv"</span> &gt;&gt; ~/.bashrc
</pre>
<p>Log out and back in, or source the file again: <code>source ~/.bashrc</code>.  All the binaries for neuron should then be available to you:</p>
<pre class="code bash literal-block">$ ls ~/dump/neuron-installation/x86_64/bin/
bbswork.sh   iclass  idraw  memacs        modlunit  mos2nrn2.sh  nocmodl  nrngui  nrniv_makefile  nrnmech_makefile  nrnoc_makefile  nrnpyenv.sh  set_nrnpyenv.sh
hel2mos1.sh  idemo   ivoc   mkthreadsafe  mos2nrn   neurondemo   nrnenv   nrniv   nrnivmodl       nrnoc             nrnocmodl       oc           sortspike

$ which idraw
~/dump/neuron-installation/x86_64/bin/idraw
$ which nrniv
~/dump/neuron-installation/x86_64/bin/nrniv
$ which nrnoc
~/dump/neuron-installation/x86_64/bin/nrnoc
$ which oc
~/dump/neuron-installation/x86_64/bin/oc
</pre>
<p>I think that should be it! I've tested the instructions on my Fedora 24 machine but if you run into issues, drop a comment and I'll look into it.</p>
</div>
</div></div>
    </summary>
    <updated>2016-08-05T12:24:48Z</updated>
    <published>2016-08-05T12:24:48Z</published>
    <category term="Fedora"/>
    <category term="Neuron"/>
    <category term="Computational neuroscience"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-08-04:blog/2016/08/04/tinkering-with-openlayers-and-js-cajal-a-hacked-up-neuroscience-research-map.html</id>
    <link href="http://ankursinha.in/blog/2016/08/04/tinkering-with-openlayers-and-js-cajal-a-hacked-up-neuroscience-research-map.html" rel="alternate" type="text/html"/>
    <title>Tinkering with OpenLayers and JS - Cajal - a hacked up neuroscience research map</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p>I was a bit fed up with the various minute issues my simulations kept throwing at me and decided I needed a distraction to keep me from completely burning out. Research is hard work, and sometimes we hit solid walls where no progress seems possible. I haven't hit one yet, but I was beginning to see that my performance had begun to drop. The simplest answer to this situation is to take a holiday - a change of scenery. Unfortunately, I haven't any plans to take one at the moment. I've never understood the appeal of wandering around crowded cities with throngs of tourists anyway. Instead, I decided to set my simulations aside for a few days and tinker with other things for a bit.</p>
<p>I decided to take up a short "passion project". It needed to be something that would keep me occupied for a few days at the most. I'd tinkered with <a class="reference external" href="http://openlayers.org/">OpenLayers</a> before and I'd been meaning to brush up on my <a class="reference external" href="https://www.javascript.com/">JavaScript</a> recently seeing as how it's become quite a dominant scripting language. So I thought up a simple web application that would use the two to do something useful.</p>
<div class="section" id="cajal">
<h2>Cajal</h2>
<p>To start with, the app needs to have a name. I've come up with some unique ones before (<a class="reference external" href="http://ankursinha.in/blog/tag/zaphod/">Zaphod</a>, <a class="reference external" href="http://ankursinha.in/blog/tag/calliope/">Calliope</a>). This time I decided to pay homage to <a class="reference external" href="https://en.wikipedia.org/wiki/Santiago_Ram%C3%B3n_y_Cajal">Santiago Ramón y Cajal</a> who is considered the father of modern neuroscience. There are multiple applications called Cajal already, but not too many of them seem to be related to neuroscience. Unique enough, then.</p>
<p>Cajal is a simple web page that shows a world map. On this map are markers that denote different neuroscience laboratories. The markers are clickable, so when you click one of these, some information about the laboratory is displayed below the map - the principal investigator, the website address, and the sort. I've only managed to add a few laboratories to it now, but I've hosted a working demo <a class="reference external" href="http://ankursinha.in/cajal-map/">here</a>. The screenshot below shows what it looks like.</p>
<a class="reference external image-reference" href="http://ankursinha.in/blog/images/20160804-cajal.png"><img alt="Screenshot of Cajal web application" class="align-center" src="http://ankursinha.in/blog/images/20160804-cajal.png" style="height: 400.0px;"/></a>
<p>The code is quite simple. The data is stored in a <code>yaml</code> file at <code>data/groups.yaml</code>. The Python script <code>bin/populate_map.py</code> takes this file and generates a <a class="reference external" href="https://www.javascript.com/">JavaScript</a> file with functions to set up the map, overlay the markers, and assign them all <code>singleclick</code> events that display information - <code>js/cajal.js</code>. The main <code>index.html</code> file uses this JavaScript file to show a map and the markers with their associated information.</p>
<p>Maybe there is a better, less hacky, way of going about it, but this works for a quick two day project. In the future, maybe I can use a server side database and so on - it depends on how much it needs to scale. I know my shared hosting account can't handle all that!</p>
<p>The <a class="reference external" href="https://github.com/sanjayankur31/cajal/">source code is available on Github</a>. To add more laboratories, entries need to be added to the <code>data/groups.yaml</code> file - that's all. If you're a neuroscience researcher and want to add to the map, please open pull requests and I can then periodically regenerate the page as required.</p>
</div></div>
    </summary>
    <updated>2016-08-04T17:49:08Z</updated>
    <published>2016-08-04T17:49:08Z</published>
    <category term="Community"/>
    <category term="Computational neuroscience"/>
    <category term="Fedora"/>
    <category term="Programming"/>
    <category term="Python"/>
    <category term="OpenLayers"/>
    <category term="JavaScript"/>
    <category term="Cajal"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-06-02:blog/2016/06/02/checking-your-latex-sources-for-spelling-errors-with-hunspell.html</id>
    <link href="http://ankursinha.in/blog/2016/06/02/checking-your-latex-sources-for-spelling-errors-with-hunspell.html" rel="alternate" type="text/html"/>
    <title>Checking your LaTeX sources for spelling errors with Hunspell</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p>I usually use <a class="reference external" href="http://www.vim.org/">Vim</a> and a <a class="reference external" href="https://en.wikipedia.org/wiki/Makefile">Makefile</a> when writing LaTeX documents. Even though <a class="reference external" href="http://vimdoc.sourceforge.net/htmldoc/spell.html">Vim does permit you to check your spellings</a>, it's always nice to run the entire text through a standalone spell checker before passing your documents on to others.</p>
<p>The workflow is quite simple. Once you've written your text, you commit your changes, and then you can use one of either <a class="reference external" href="http://aspell.net/">Aspell</a> or <a class="reference external" href="http://hunspell.github.io/">Hunspell</a> to check your text for spelling errors. Both provide an interactive interface that makes them easy to use.</p>
<p>On <a class="reference external" href="http://getfedora.org">Fedora</a>, you can install them using <code>dnf</code>:</p>
<pre class="code bash literal-block">sudo dnf install aspell hunspell
</pre>
<p>You'll also need to make sure you have the language files installed:</p>
<pre class="code bash literal-block">sudo dnf install aspell-en hunspell-en
</pre>
<p>Then, to check all your <code>.tex</code> files, you can use something like this:</p>
<pre class="code bash literal-block">find . -name <span class="s2">"*.tex"</span> -exec aspell --lang<span class="o">=</span>en --mode<span class="o">=</span>tex check <span class="s2">"{}"</span> <span class="se">\;</span> <span class="c1"># Aspell
</span>find . -name <span class="s2">"*.tex"</span> -exec hunspell -t -i utf-8 <span class="s1">'{}'</span> <span class="se">\;</span> <span class="c1"># Hunspell</span>
</pre>
<p>I looked around a bit, and decided to use <a class="reference external" href="http://hunspell.github.io/">Hunspell</a>. It's used by LibreOffice, Firefox, and other applications. I commit my work first and then run the above command which opens a window like this:</p>
<a class="reference external image-reference" href="http://ankursinha.in/blog/images/hunspell-example.png"><img alt="Hunspell screenshot" src="http://ankursinha.in/blog/images/hunspell-example.png" style="width: 750px;"/></a>
<p>Once you've gone through it and made your changes, you can then use <code>git diff --word-diff</code> to review your changes. If you'd like to undo some of them, use <code>git add -i</code> and so on:</p>
<a class="reference external image-reference" href="http://ankursinha.in/blog/images/git-word-diff.png"><img alt="Git diff screenshot" src="http://ankursinha.in/blog/images/git-word-diff.png" style="width: 750px;"/></a>
<p>That's it! Happy writing!</p></div>
    </summary>
    <updated>2016-06-02T10:42:00Z</updated>
    <published>2016-06-02T10:42:00Z</published>
    <category term="Fedora"/>
    <category term="Git"/>
    <category term="LaTeX"/>
    <category term="Linux"/>
    <category term="Vim"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-05-31:blog/2016/05/31/some-tips-and-tricks-for-running-simulations-on-a-cluster.html</id>
    <link href="http://ankursinha.in/blog/2016/05/31/some-tips-and-tricks-for-running-simulations-on-a-cluster.html" rel="alternate" type="text/html"/>
    <title>Some tips and tricks for running simulations on a cluster</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p>To begin with, you must use a terminal multiplexer! I use <a class="reference external" href="http://byobu.org/">Byobu with tmux</a> to multiplex a single SSH session. I use it on all my machines. It's an excellent tool.</p>
<div class="section" id="monitoring-your-jobs">
<h2>Monitoring your jobs</h2>
<p>Three of my Byobu screens run these commands to monitor the queue and my jobs:</p>
<pre class="code bash literal-block">watch -n <span class="m">30</span> qstat main
watch -n <span class="m">30</span> qstat -B
watch -n <span class="m">30</span> /usr/local/maui/bin/showq -u asinha
</pre>
<p><code>showq</code> may be installed elsewhere. Use <code>which showq</code> to locate it. More information on the commands can be found in their manuals:</p>
<pre class="code bash literal-block">man watch
man qstat
</pre>
<p>Remember, to find a man page, you can use the <code>apropos</code> command.</p>
<p>I run all my simulations in a specific directory on the shared data disk. I usually also monitor this folder. It gives me an idea of how much my simulations have progressed. Something like this works:</p>
<pre class="code bash literal-block">watch -n <span class="m">30</span> <span class="s1">'du -sch *'</span> <span class="c1"># in the directory that stores simulation results*</span>
</pre>
</div>
<div class="section" id="use-git">
<h2>Use Git</h2>
<p>Of course. If you make frequent changes, you must use a version control system. I stick to <code>git</code> myself. You can use <code>svn</code> or <code>hg</code> if you wish - whatever floats your boat.</p>
<p>An issue I've stumbled upon while working with the cluster is that the program you want it to run is not loaded into memory until your job begins to run. So, if you want to run a certain version of your program on the cluster, say some version_1, you must not make any changes to this version until the queued job has begun to run. This is extremely inconvenient, especially if you make frequent changes to your simulations, as is often the case in research. I would, for example, like to queue separate jobs in parallel for a myriad of tiny changes and then compare results.</p>
<p>Enter <a class="reference external" href="https://git-scm.com/docs/git-worktree">git work-tree</a>! The simplest solution to the aforementioned issue is to checkout different work-trees for commits you want to test and queue up jobs for each individually. This would work really well. Once the simulation finishes, you can remove the work-tree.</p>
<p>Unfortunately, clusters usually run stable long term support oriented versions of Linux distributions - EL/CentOS/Scientific. As a result, it's quite probable that the version of git on the cluster doesn't support work-trees - as is the case with the cluster I use. I came up with a workaround which works somewhat like work-trees - I manually clone my source repository to a temporary location, checkout the commit I want to run (which is what work-trees sort of are), and set up a job that runs this particular simulation version. It uses two scripts:</p>
<ul class="simple">
<li>A template PBS script for the simulation run. This will be passed to <code>qsub</code>.</li>
<li>A script that clones my repo, checks out the required commit, completes the template script, and calls <code>qsub</code> to queue up the job.</li>
</ul>
<p>The first is a simple PBS script:</p>
<pre class="code bash literal-block"><span class="c1"># File: run-sim.sh
</span>
<span class="c1">#PBS -l walltime=48:00:00
#PBS -l nodes=50
#PBS -m abe
#PBS -N nest_v_s
</span>
module unload mpi/mpich-x86_64
module load mvapich2-1.7

<span class="nv">SIM_PATH</span><span class="o">=</span><span class="s2">"/stri-data/asinha/simulations-nest/"</span>
<span class="nv">SIM_TIME</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">PROGRAM_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SIM_PATH</span><span class="s2">""</span><span class="nv">$SIM_TIME</span><span class="s2">""/Sinha2016/src/Sinha2016.py"</span>
<span class="nv">RESULT_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SIM_PATH</span><span class="s2">""</span><span class="nv">$SIM_TIME</span><span class="s2">""/result/"</span>
<span class="nv">NUM_NODES</span><span class="o">=</span>50

<span class="nb">echo</span> ------------------------------------------------------
<span class="nb">echo</span> <span class="s1">'Job is running on nodes'</span><span class="p">;</span> cat <span class="nv">$PBS_NODEFILE</span>
<span class="nb">echo</span> ------------------------------------------------------
<span class="nb">echo</span> PBS: qsub is running on <span class="nv">$PBS_O_HOST</span>
<span class="nb">echo</span> PBS: originating queue is <span class="nv">$PBS_O_QUEUE</span>
<span class="nb">echo</span> PBS: executing queue is <span class="nv">$PBS_QUEUE</span>
<span class="nb">echo</span> PBS: working directory is <span class="nv">$PBS_O_WORKDIR</span>
<span class="nb">echo</span> PBS: execution mode is <span class="nv">$PBS_ENVIRONMENT</span>
<span class="nb">echo</span> PBS: job identifier is <span class="nv">$PBS_JOBID</span>
<span class="nb">echo</span> PBS: job name is <span class="nv">$PBS_JOBNAME</span>
<span class="nb">echo</span> PBS: node file is <span class="nv">$PBS_NODEFILE</span>
<span class="nb">echo</span> PBS: current home directory is <span class="nv">$PBS_O_HOME</span>
<span class="nb">echo</span> PBS: <span class="nv">PATH</span> <span class="o">=</span> <span class="nv">$PBS_O_PATH</span>
<span class="nb">echo</span> ------------------------------------------------------

<span class="nb">echo</span> <span class="s2">"ANKUR&gt;&gt; Begun at </span><span class="nv">$SIM_TIME</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"ANKUR&gt;&gt; Script: </span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">"</span>

mkdir -pv <span class="nv">$RESULT_PATH</span>
<span class="nb">cd</span> <span class="nv">$RESULT_PATH</span>

/usr/local/bin/mpiexec -n <span class="nv">$NUM_NODES</span> python <span class="nv">$PROGRAM_PATH</span>

<span class="nv">END_TIME</span><span class="o">=</span><span class="k">$(</span>date +%Y%m%d%H%M<span class="k">)</span>
<span class="nb">echo</span> <span class="s2">"ANKUR&gt;&gt; Ended at </span><span class="nv">$END_TIME</span><span class="s2">"</span>
</pre>
<p>It sets up the required PBS options, then loads the MPI module I wish to use. It creates a directory where my simulation's results will be stored, enters it, and then uses <code>mpiexec</code> to run my Python program.</p>
<p>The second script is a wrapper that clones the required commit, sets up the correct paths in the above script and the calls <code>qsub</code>:</p>
<pre class="code bash literal-block"><span class="c1"># File: setup-job.sh
</span>
<span class="nv">SOURCE_PATH</span><span class="o">=</span><span class="s2">"/home/asinha/Documents/02_Code/00_repos/00_mine/Sinha2016/"</span>
<span class="nv">GIT_COMMIT</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">SIM_PATH</span><span class="o">=</span><span class="s2">"/stri-data/asinha/simulations-nest/"</span>
<span class="nv">SIM_TIME</span><span class="o">=</span><span class="k">$(</span>date +%Y%m%d%H%M<span class="k">)</span>
<span class="nv">RUN_SCRIPT</span><span class="o">=</span><span class="s2">"scripts/cluster/nest-runsim.sh"</span>
<span class="nv">RUN_NEW</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">ERROR</span><span class="o">=</span><span class="s2">"no"</span>
<span class="nv">NUM_NODES</span><span class="o">=</span>50
<span class="nv">CUR_SIM_PATH</span><span class="o">=</span><span class="s2">""</span>

<span class="k">function</span> queue_task
<span class="o">{</span>
    <span class="nb">pushd</span> <span class="s2">"</span><span class="nv">$CUR_SIM_PATH</span><span class="s2">"</span>
        qsub <span class="s2">"</span><span class="nv">$RUN_NEW</span><span class="s2">"</span>
    <span class="nb">popd</span>
<span class="o">}</span>

<span class="k">function</span> setup_env
<span class="o">{</span>
    <span class="nv">CUR_SIM_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SIM_PATH</span><span class="s2">""</span><span class="nv">$SIM_TIME</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"This simulation will run in: </span><span class="nv">$CUR_SIM_PATH</span><span class="s2">"</span>
    mkdir -pv <span class="s2">"</span><span class="nv">$CUR_SIM_PATH</span><span class="s2">"</span>

    <span class="nb">pushd</span> <span class="s2">"</span><span class="nv">$CUR_SIM_PATH</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Cloning source repository..."</span>
        git clone <span class="s2">"</span><span class="nv">$SOURCE_PATH</span><span class="s2">"</span> <span class="s2">"Sinha2016"</span>

        <span class="nb">pushd</span> <span class="s2">"Sinha2016"</span>
            <span class="nb">echo</span> <span class="s2">"Checking out commit </span><span class="nv">$GIT_COMMIT</span><span class="s2">..."</span>
            git checkout -b this_sim <span class="s2">"</span><span class="nv">$GIT_COMMIT</span><span class="s2">"</span>
            <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$?</span><span class="s2">"</span> -ne <span class="m">0</span> <span class="o">]</span>
            <span class="k">then</span>
                <span class="nb">echo</span> <span class="s2">"Error occured. Could not checkout </span><span class="nv">$GIT_COMMIT</span><span class="s2">. Exiting..."</span>
                <span class="nv">ERROR</span><span class="o">=</span><span class="s2">"yes"</span>
            <span class="k">fi</span>
        <span class="nb">popd</span>

        <span class="k">if</span> <span class="o">[</span> <span class="s2">"xyes"</span> <span class="o">==</span>  x<span class="s2">"</span><span class="nv">$ERROR</span><span class="s2">"</span> <span class="o">]</span>
        <span class="k">then</span>
            <span class="nb">exit</span> -1
        <span class="k">fi</span>

        <span class="nv">RUN_NEW</span><span class="o">=</span><span class="s2">"nest_""</span><span class="nv">$GIT_COMMIT</span><span class="s2">"".sh"</span>
        <span class="nb">echo</span> <span class="s2">"Setting up </span><span class="nv">$RUN_NEW</span><span class="s2">..."</span>
        cp <span class="s2">"</span><span class="nv">$SOURCE_PATH</span><span class="s2">""</span><span class="nv">$RUN_SCRIPT</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$RUN_NEW</span><span class="s2">"</span> -v
        sed -i <span class="s2">"s|nest_v_s|nest_</span><span class="nv">$GIT_COMMIT</span><span class="s2">|"</span> <span class="s2">"</span><span class="nv">$RUN_NEW</span><span class="s2">"</span>
        sed -i <span class="s2">"s|nodes=.*|nodes=</span><span class="nv">$NUM_NODES</span><span class="s2">|"</span> <span class="s2">"</span><span class="nv">$RUN_NEW</span><span class="s2">"</span>
        sed -i <span class="s2">"s|NUM_NODES=.*|NUM_NODES=</span><span class="nv">$NUM_NODES</span><span class="s2">|"</span> <span class="s2">"</span><span class="nv">$RUN_NEW</span><span class="s2">"</span>
        sed -i <span class="s2">"s|SIM_TIME=.*|SIM_TIME=</span><span class="nv">$SIM_TIME</span><span class="s2">|"</span> <span class="s2">"</span><span class="nv">$RUN_NEW</span><span class="s2">"</span>
    <span class="nb">popd</span>
<span class="o">}</span>

<span class="k">function</span> usage
<span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"Queue up a job to run a particular git commit"</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2"> &lt;git_commit&gt; &lt;number_nodes&gt;"</span>
<span class="o">}</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$#</span><span class="s2">"</span> -ne <span class="m">2</span> <span class="o">]</span><span class="p">;</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">"Error occurred. Exiting..."</span>
    <span class="nb">echo</span> <span class="s2">"Received </span><span class="nv">$#</span><span class="s2"> arguments. Expected: 3"</span>
    usage
    <span class="nb">exit</span> -1
<span class="k">fi</span>

<span class="nv">GIT_COMMIT</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="nv">NUM_NODES</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
setup_env
queue_task

<span class="nb">exit</span> 0
</pre>
<p>This takes two arguments, as the <code>usage</code> function will tell you. The first argument is the commit you want to run the simulation for, and the second is the number of nodes you want to use. It'll clone your repository to a temporary location and checkout this specified commit. Then, it'll modify the first script <code>run-sim.sh</code> to set up the correct path to the code and also correctly specify the number of nodes you'd want to request. Finally, once all this is done, it'll call <code>qsub run-sim.sh</code> to queue up your job. I use unique date stamps as directory names to distinguish between simulation runs, but you can use another unique identifier.</p>
<p>Now, this copy of your code, at the specified commit will be used for the job you've queued. You can merrily go about tinkering with the main source repo without affecting queued up jobs. Yay!</p>
<p>Even though I've used Python here, you can use similar scripts for compiled languages. You'll simply have to compile your executable after you checkout the required commit.</p>
</div>
<div class="section" id="other-miscellaneous-stuff">
<h2>Other miscellaneous stuff</h2>
<p>My lab mate, Alex, recently introduced me to <a class="reference external" href="https://www.continuum.io/downloads">Anaconda</a>. It's a great tool for that lets you install packages in your user specific directory. It contains quite a few python and other related packages. No need to use <code>sudo</code> with it, and you can use <code>pip</code> etc. with it too. It even lets you set up virtual environments and things.</p>
<p>I think that's it for today. I'll update the post with other things I find/learn as I continue my adventures with the cluster.</p>
</div></div>
    </summary>
    <updated>2016-05-31T18:17:32Z</updated>
    <published>2016-05-31T18:17:32Z</published>
    <category term="Bash"/>
    <category term="Computational neuroscience"/>
    <category term="Git"/>
    <category term="Linux"/>
    <category term="NEST"/>
    <category term="Programming"/>
    <category term="Fedora"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-03-05:blog/2016/03/05/calliope-helping-you-keep-a-diary-in-latex.html</id>
    <link href="http://ankursinha.in/blog/2016/03/05/calliope-helping-you-keep-a-diary-in-latex.html" rel="alternate" type="text/html"/>
    <title>Calliope - helping you keep a diary - in LaTeX!</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p>Quite a few people write personal diaries - researchers tend to also keep research diaries where we note our generally brilliant ideas. I've used <a class="reference external" href="http://lifeograph.sourceforge.net/wiki/Main_Page">Lifeograph</a> for a number of years now. It's a great application with all the right features that a diary needs - chapters, tags, and  metrics. It doesn't quite work for a <em>research diary</em>, though - it doesn't support maths notation for a start, and we really do write a lot of very complicated maths from time to time. (The kinds with lots of symbols you see in the films? Think "<a class="reference external" href="http://www.imdb.com/title/tt0268978/">A beautiful mind</a>".)</p>
<p>The simple solution, of course, is <a class="reference external" href="http://lifeograph.sourceforge.net/wiki/Main_Page">LaTeX</a>. <a class="reference external" href="http://lifeograph.sourceforge.net/wiki/Main_Page">LaTeX</a> is used extensively in academic writing. While it does have a reputation for being complex and complicated (<a class="reference external" href="http://english.stackexchange.com/questions/10459/what-is-the-difference-between-complicated-and-complex">YES! There's a difference in the two words - they're not interchangeable!</a>) at times, it is by far the best tool for academic writing. It has everything a researcher needs - citation support, can be customised to fit multiple format, and if you pair it with <a class="reference external" href="https://git-scm.com/">Git</a> you even have versioning and <a class="reference external" href="http://ankursinha.in/blog/tag/zaphod/">change tracking</a>.</p>
<div class="section" id="calliope">
<h2>Calliope</h2>
<p>I went looking for packages that may provide this functionality in <a class="reference external" href="http://lifeograph.sourceforge.net/wiki/Main_Page">LaTeX</a> but didn't quite find any that had a convenient workflow and so on. I ran into a <a class="reference external" href="https://github.com/mikhailklassen/research-diary-project">this Github project</a> instead, which is a set of templates and scripts that does quite a good job. I've forked it and made some improvements. There's now a single script that takes arguments, for example. I've also added support for indexing - which works similar to tagging - it'll generate a nice clickable index at the end of the document. Of course, I've given it a fancy name, <a class="reference external" href="https://github.com/sanjayankur31/calliope">Calliope, and put it up on Github</a>.</p>
<p>Usage is quite straightforward:</p>
<pre class="code bash literal-block"><span class="o">[</span>asinha@cs-as14aho-2-herts-ac-uk  00_research_diary<span class="o">(</span>master %<span class="o">=)]</span>$ ./calliope.sh -h
    usage: ./calliope.sh options

    Master script file that provides functions to maintain a journal using LaTeX.

    OPTIONS:
    -h  Show this message and quit

    -t  Add new entry <span class="k">for</span> today

    -c  Compile today<span class="err">'</span>s entry

    -a  &lt;year&gt;
        Year to generate anthology of

    -p  &lt;year&gt;
        Compile all entries in this year

    -s  &lt;entry&gt; <span class="o">(</span>yyyy-mm-dd<span class="o">)</span>
        Compile specific entry
</pre>
<p>This is what the directory structure looks like:</p>
<pre class="code bash literal-block"><span class="o">[</span>asinha@cs-as14aho-2-herts-ac-uk  00_research_diary<span class="o">(</span>master %<span class="o">=)]</span>$ tree
.
├── calliope.sh
├── diary
│   ├── 2016
│   │   ├── 2016-03-04.tex
│   │   ├── 2016-03-05.tex
│   │   ├── images
│   │   ├── research_diary.sty -&gt; ../../templates/research_diary.sty
│   │   └── stdp_connection_symmetric.h
│   └── research_diary.sty -&gt; ../templates/research_diary.sty
├── pdfs
│   └── 2016
│       ├── 2016-03-04.pdf
│       └── 2016-03-05.pdf
├── README.rst
└── templates
    ├── entry.tex
    └── research_diary.sty

        <span class="m">6</span> directories, <span class="m">11</span> files
</pre>
<p>The script generates your source <a class="reference external" href="http://lifeograph.sourceforge.net/wiki/Main_Page">LaTeX</a> files and puts them in the folders in <tt class="docutils literal">diary/</tt>. Then you write up and use the script to compile it - the generated pdfs are collected in the <tt class="docutils literal">pdfs/</tt> folder. The script can also generate an anthology for a year you pick. The resultant pdf for a daily entry will look like this:</p>
<a class="reference external image-reference" href="http://ankursinha.in/blog/images/20160305-Calliope.png"><img alt="Screenshot showing pdf generated by Calliope" class="align-center" src="http://ankursinha.in/blog/images/20160305-Calliope.png" style="width: 500px;"/></a>
<p>That's pretty much it. Commit your entry to Git and you're done.</p>
<p>So, give it a go and please <a class="reference external" href="https://github.com/sanjayankur31/calliope/issues/">file issues</a> if you have any suggestions that would improve it.</p>
</div></div>
    </summary>
    <updated>2016-03-05T14:07:52Z</updated>
    <published>2016-03-05T14:07:52Z</published>
    <category term="Fedora"/>
    <category term="Git"/>
    <category term="LaTeX"/>
    <category term="Linux"/>
    <category term="Calliope"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-03-02:blog/2016/03/02/sli-vim-syntax-file-for-the-nest-simulators-sli-language.html</id>
    <link href="http://ankursinha.in/blog/2016/03/02/sli-vim-syntax-file-for-the-nest-simulators-sli-language.html" rel="alternate" type="text/html"/>
    <title>sli.vim - syntax file for the NEST simulator's SLI language</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p>I've been reading some of <a class="reference external" href="http://nest-simulator.org">NEST</a>'s <a class="reference external" href="http://www.nest-simulator.org/quickref/">SLI</a> examples to understand the simulation better. I noticed that these files had no syntax highlighting at all which made the code difficult to read. I couldn't find a syntax highlighting file for Vim anywhere so I've begun writing my own. It isn't complete, and I'm sure it's buggy, but it already seems to make reading and writing SLI easier. Here's what it makes an SLI file look like:</p>
<a class="reference external image-reference" href="http://ankursinha.in/blog/images/20160302-sli-vim.png"><img alt="Screenshot showing SLI syntax highlighting in Vim" class="align-center" src="http://ankursinha.in/blog/images/20160302-sli-vim.png" style="width: 500px;"/></a>
<div class="section" id="installation">
<h2>Installation</h2>
<p>It's just a syntax file. You can drop it in <tt class="docutils literal"><span class="pre">~/.vim/syntax/</span></tt> directory (on Linux) or you can use <a class="reference external" href="https://github.com/tpope/vim-pathogen">pathogen</a> and just clone the repository and so on. Once done, add this to your <tt class="docutils literal">vimrc</tt> file:</p>
<pre class="code vim literal-block"><span class="k">au</span> <span class="nb">BufRead</span><span class="p">,</span><span class="nb">BufNewFile</span> *.sli <span class="k">set</span> <span class="k">filetype</span><span class="p">=</span>sli
<span class="k">au</span> <span class="nb">FileType</span> sli <span class="k">setl</span> <span class="nb">foldenable</span> <span class="nb">foldmethod</span><span class="p">=</span><span class="nb">syntax</span>
</pre>
<p>The file is <a class="reference external" href="https://github.com/sanjayankur31/sli.vim">hosted on Github</a>. Feel free to open issues, or even better, pull requests ;)</p>
</div></div>
    </summary>
    <updated>2016-03-02T10:53:58Z</updated>
    <published>2016-03-02T10:53:58Z</published>
    <category term="Computational neuroscience"/>
    <category term="Fedora"/>
    <category term="Programming"/>
    <category term="Vim"/>
    <category term="NEST"/>
    <category term="sli-vim"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>

  <entry>
    <id>tag:ankursinha.in,2016-02-28:blog/2016/02/28/new-zaphod-release-v0-5-7.html</id>
    <link href="http://ankursinha.in/blog/2016/02/28/new-zaphod-release-v0-5-7.html" rel="alternate" type="text/html"/>
    <title>New Zaphod release - v0.5.7</title>
    <summary type="xhtml"><div xmlns="http://www.w3.org/1999/xhtml"><p><a class="reference external" href="http://ankursinha.in/blog/2016/02/13/zaphod-a-latex-change-tracking-tool.html">I'd written about Zaphod recently</a>. I've been making some tweaks to it - just some enhancements to the revision bit which will make it easier to use. The diff bit is still the same - I didn't see the need to make too many improvements there.</p>
<div class="section" id="new-revision-bits">
<h2>New revision bits</h2>
<p>Now, it looks like this when you start it up:</p>
<pre class="code bash literal-block"><span class="o">[</span>asinha@cs-as14aho-2-herts-ac-uk  latex-changes<span class="o">(</span>201602281328-latexdiff-annotated<span class="o">)]</span>$ python3 ../zaphod/zaphod.py revise -m paper.tex -s src
<span class="o">[</span>Zaphod<span class="o">]</span> LaTeX files with annotations:
<span class="o">[</span>1<span class="o">]</span> src/discussion.tex
<span class="o">[</span>2<span class="o">]</span> src/introduction.tex
<span class="o">[</span>3<span class="o">]</span> src/paper.tex
<span class="o">[</span>4<span class="o">]</span> src/methods.tex

Pick file to revise? 1-4/Q/q:
</pre>
<p>The idea here is that the user should be able to pick what file they want to edit. Previously, Zaphod just went file after file.</p>
<p>Once you pick a file, it'll look like this:</p>
<pre class="code bash literal-block">....
Pick file to revise? 1-4/Q/q: <span class="nv">1</span>

<span class="o">======</span> src/discussion.tex <span class="o">======</span>
+++ Addition found +++
<span class="se">\s</span>ection<span class="o">{</span>Discussion<span class="o">}</span>

Add a new file.

+++ Addition found +++
Accept addition? Y/N/Q/y/n/q: y
<span class="o">[</span>Zaphod<span class="o">]</span> Addition accepted.

<span class="o">[</span>Zaphod<span class="o">]</span> File src/discussion.tex revised and saved.
<span class="o">[</span>Zaphod<span class="o">]</span> LaTeX files with annotations:
<span class="o">[</span>1<span class="o">]</span> src/introduction.tex
<span class="o">[</span>2<span class="o">]</span> src/paper.tex
<span class="o">[</span>3<span class="o">]</span> src/methods.tex

Pick file to revise? 1-3/Q/q:
</pre>
<p>But, you can also make partial revisions. This is handy in situations where you have a long file and do not have the time to go over all of it at once. So, here's an example. I go over some changes, but I need to stop there for the moment:</p>
<pre class="code bash literal-block">...
<span class="o">[</span>Zaphod<span class="o">]</span> LaTeX files with annotations:
<span class="o">[</span>1<span class="o">]</span> src/introduction.tex
<span class="o">[</span>2<span class="o">]</span> src/paper.tex
<span class="o">[</span>3<span class="o">]</span> src/methods.tex

Pick file to revise? 1-3/Q/q: <span class="nv">2</span>

<span class="o">======</span> src/paper.tex <span class="o">======</span>
--- Deletion found ---
Tracking
--- Deletion found ---
Accept deletion? Y/N/Q/y/n/q: y
<span class="o">[</span>Zaphod<span class="o">]</span> Deletion accepted.

<span class="o">======</span> src/paper.tex <span class="o">======</span>
+++ Addition found +++
Visualising
+++ Addition found +++
Accept addition? Y/N/Q/y/n/q: y
<span class="o">[</span>Zaphod<span class="o">]</span> Addition accepted.

<span class="o">======</span> src/paper.tex <span class="o">======</span>
+++ Addition found +++
<span class="se">\i</span>nput<span class="o">{</span>discussion<span class="o">}</span>

+++ Addition found +++
Accept addition? Y/N/Q/y/n/q: q
Save partial file? Y/N/y/n: y
<span class="o">[</span>Zaphod<span class="o">]</span> Some files still have latexdiff annotations:
<span class="o">[</span>1<span class="o">]</span> src/introduction.tex
<span class="o">[</span>2<span class="o">]</span> src/methods.tex

Generate pdf? Y/y/N/n: n
<span class="o">[</span>Zaphod<span class="o">]</span> Not generating pdf.
<span class="o">[</span>Zaphod<span class="o">]</span> Following files have been revised <span class="o">(</span>maybe partially<span class="o">)</span>:
<span class="o">[</span>1<span class="o">]</span> src/discussion.tex
<span class="o">[</span>2<span class="o">]</span> src/paper.tex

Commit current changes? Y/y/N/n: n
<span class="o">[</span>Zaphod<span class="o">]</span> Exiting without committing.
</pre>
<p>There's one catch here, though. Because I want to make absolutely sure that Zaphod doesn't make any changes "by mistake", you'll have to either stash or commit these changes before you can run Zaphod again. This is just to be on the safer side. A better way would probably be for Zaphod to remember what files were partially revised, but I haven't implemented it at the moment. I'd actually just commit the changes - I mean, that's why we've got Git, right?</p>
<pre class="code bash literal-block"><span class="o">[</span>asinha@cs-as14aho-2-herts-ac-uk  latex-changes<span class="o">(</span>201602281328-latexdiff-annotated *<span class="o">)]</span>$ python3 ../zaphod/zaphod.py revise -m paper.tex -s src
Modifed or untracked files found.
git status output:
 M src/discussion.tex
 M src/paper.tex

Please stash or commit and rerun Zaphod.
</pre>
<p>That's it. I think it's a lot easier to use now, and in this design addresses a lot more use cases than it did before.</p>
<p><a class="reference external" href="https://github.com/sanjayankur31/zaphod/releases">Give it a go</a> and <a class="reference external" href="https://github.com/sanjayankur31/zaphod/issues/new">let me know</a> if things break - I've tested it myself, but only on a mock document.</p>
</div></div>
    </summary>
    <updated>2016-02-28T16:52:27Z</updated>
    <published>2016-02-28T16:52:27Z</published>
    <category term="LaTeX"/>
    <category term="Programming"/>
    <category term="Git"/>
    <category term="Fedora"/>
    <category term="Zaphod"/>
    <author>
      <name>ankur</name>
    </author>
    <source>
      <id>http://ankursinha.in/blog/</id>
      <link href="http://ankursinha.in/blog/" rel="alternate" type="text/html"/>
      <link href="http://ankursinha.in/blog/feeds/categories/research.atom.xml" rel="self" type="application/atom+xml"/>
      <title>ankursinha.in/blog</title>
      <updated>2016-10-17T07:26:30Z</updated>
    </source>
  </entry>
</feed>
